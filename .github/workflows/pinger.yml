# .github/workflows/pinger.yml

name: Advanced Website Pinger

on:
  schedule:
    - cron: '*/15 * * * *'
  workflow_dispatch:

jobs:
  ping_websites:
    runs-on: ubuntu-latest
    
    # === EDIT THIS LINE TO ADD YOUR SITES ===
    # Add your websites here, separated by spaces.
    env:
      SITES: "https://jiosaavnapi-bok7.onrender.com/ https://jiosaavnapi-tyye.onrender.com"

    steps:
      - name: Ping Multiple Websites
        run: |
          # A flag to track if any site is down
          all_sites_up=true

          echo "Pinging the following sites: $SITES"
          echo "-------------------------------------"

          # Loop through each site listed in the SITES environment variable
          for site in $SITES; do
            # Use curl to get the HTTP status code
            # --max-time 10: Set a 10-second timeout for the request
            # --write-out '%{http_code}': Print only the HTTP status code
            # --silent --output /dev/null: Suppress all other output
            status_code=$(curl --max-time 10 -L --write-out '%{http_code}' --silent --output /dev/null "$site")

            # Check if the status code is a success code (2xx or 3xx)
            if [[ "$status_code" -ge 200 && "$status_code" -lt 400 ]]; then
              echo "‚úÖ [UP] $site (Status: $status_code)"
            else
              echo "‚ùå [DOWN] $site (Status: $status_code)"
              all_sites_up=false
            fi
          done

          echo "-------------------------------------"
          # If any site was down, exit with a failure code to fail the workflow
          if [ "$all_sites_up" = false ]; then
            echo "üö® At least one site is down. Failing the workflow."
            exit 1
          else
            echo "üéâ All sites are up!"
          fi